<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Playlist</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>

  </script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- font awesome cdn link  -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
  <!-- box icon link -->
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <!-- custom css file link  -->
  <link rel="stylesheet" href="css/style.css">
  <style>
    li {
      margin-left: 16px;
    }

    a {
      cursor: pointer;
    }




    .container {
      width: 100%;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .toolbar {
      padding: 16px;
      background: #eee;
    }

    .toolbar .head {
      display: flex;
      grid-gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .toolbar .head>input {
      max-width: 100px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 2px solid #ddd;
      outline: none;
    }

    .toolbar .head select {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      cursor: pointer;
    }

    .toolbar .head .color {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      grid-gap: 6px;
      padding: 0 10px;
    }

    .toolbar .head .color span {
      font-size: 14px;
    }

    .toolbar .head .color input {
      border: none;
      padding: 0;
      width: 26px;
      height: 26px;
      background: #fff;
      cursor: pointer;
    }

    .toolbar .head .color input::-moz-color-swatch {
      width: 20px;
      height: 20px;
      border: none;
      border-radius: 50%;
    }

    .toolbar .btn-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      grid-gap: 10px;
    }

    .toolbar .btn-toolbar button {
      background: #fff;
      border: 2px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .toolbar .btn-toolbar button:hover {
      background: #f3f3f3;
    }

    #content {
      background-color: #f3f3f3;
      padding: 16px;
      font-size: 17px;
      outline: none;
      max-height: 50vh;
      overflow: auto;
    }

    #show-code[data-active="true"] {
      background: #eee;
    }



    .action-container {
      position: absolute;
      bottom: 0;
      right: 0;
      padding: 5px;
      /* Optional: Add padding to the action-container */
      border-radius: 5px;
      /* Optional: Add border-radius for styling */
      display: flex;
      gap: 0.7rem;
    }

    #container-playlist-video {
      margin-bottom: 2rem;
    }

    .inline-btn {
      margin-bottom: 2rem;
    }

    /* Skeletion loading */
  </style>
  </style>
</head>

<body>
  <div id="success-message" class="success-message"></div>
  <header class="header">

    <section class="flex">

      <a href="home.html" class="logo">UIT-EDU</a>

      <form action="search.html" method="post" class="search-form">
        <input type="text" name="search_box" required placeholder="search courses..." maxlength="100">
        <button type="submit" class="fas fa-search"></button>
      </form>

      <div class="icons">
        <div id="menu-btn" class="fas fa-bars"></div>
        <div id="search-btn" class="fas fa-search"></div>
        <div id="user-btn" class="fas fa-user"></div>
        <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <div class="profile">
        <img src="images/pic-1.jpg" class="image" alt="">
        <h3 class="user-name name"></h3>
        <p class="role"></p>
        <a href="profile.html" class="btn">view profile</a>
        <div class="flex-btn">
          <a href="login.html" class="option-btn">logout</a>
        </div>
      </div>

    </section>

  </header>

  <div class="side-bar">

    <div id="close-btn">
      <i class="fas fa-times"></i>
    </div>

    <div class="profile">
      <img src="images/pic-1.jpg" class="image" alt="">
      <h3 class="user-name name"></h3>
      <p class="role"></p>
      <a href="profile.html" class="btn">view profile</a>
    </div>

    <nav class="navbar">
      <a href="home.html" id="homeLink"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="about.html" id="aboutLink"><i class="fas fa-question"></i><span>About</span></a>
      <a href="courses.html" id="coursesLink"><i class="fas fa-graduation-cap"></i><span>Courses</span></a>
      <a href="admin.html" id="teachersLink"><i class="fas fa-chalkboard-user"></i><span>Teachers</span></a>
      <a href="contact.html" id="contactLink"><i class="fas fa-headset"></i><span>Contact
          Us</span></a>
      <a href="edit-post.html" id="editPostLink" style="display: none;"><i
          class="fa-solid fa-pen-to-square"></i><span>Edit Post</span></a>
      <a href="admin.html" id="adminLink" style="display: none;"><i
          class="fa-solid fa-user-tie"></i><span>Admin</span></a>
    </nav>

  </div>

  <section class="form-container">

    <form action="" method="post" enctype="multipart/form-data" id="updateCoursesForm">
      <h3>update course</h3>
      <p id="error-message-our-course"></p>
      <p>Title</p>
      <input type="text" name="title" placeholder="Html" maxlength="50" class="box">
      <p>Description</p>
      <div class="container" id="container-description">
        <div class="toolbar">
          <div class="head">
            <input type="text" placeholder="Filename" value="untitled" id="filename">
            <select id="fileType" onchange="fileHandle(this.value); this.selectedIndex=0">
              <option value="" selected="" hidden="" disabled="">File</option>
              <option value="txt">Save as txt</option>
              <option value="pdf">Save as pdf</option>
            </select>
            <select onchange="formatDoc('formatBlock', this.value); this.selectedIndex=0;">
              <option value="" selected="" hidden="" disabled="">Format</option>
              <option value="h1">Heading 1</option>
              <option value="h2">Heading 2</option>
              <option value="h3">Heading 3</option>
              <option value="h4">Heading 4</option>
              <option value="h5">Heading 5</option>
              <option value="h6">Heading 6</option>
              <option value="p">Paragraph</option>
            </select>
            <select onchange="formatDoc('fontSize', this.value); this.selectedIndex=0;">
              <option value="" selected="" hidden="" disabled="">Font size</option>
              <option value="1">Extra small</option>
              <option value="2">Small</option>
              <option value="3">Regular</option>
              <option value="4">Medium</option>
              <option value="5">Large</option>
              <option value="6">Extra Large</option>
              <option value="7">Big</option>
            </select>
            <div class="color">
              <span>Color</span>
              <input type="color" oninput="formatDoc('foreColor', this.value); this.value='#000000';">
            </div>
            <div class="color">
              <span>Background</span>
              <input type="color" oninput="formatDoc('hiliteColor', this.value); this.value='#000000';">
            </div>
          </div>
          <div class="btn-toolbar">
            <button onclick="formatDoc('undo')"><i class='bx bx-undo'></i></button>
            <button onclick="formatDoc('redo')"><i class='bx bx-redo'></i></button>
            <button onclick="formatDoc('bold')"><i class='bx bx-bold'></i></button>
            <button onclick="formatDoc('underline')"><i class='bx bx-underline'></i></button>
            <button onclick="formatDoc('italic')"><i class='bx bx-italic'></i></button>
            <button onclick="formatDoc('strikeThrough')"><i class='bx bx-strikethrough'></i></button>
            <button onclick="formatDoc('justifyLeft')"><i class='bx bx-align-left'></i></button>
            <button onclick="formatDoc('justifyCenter')"><i class='bx bx-align-middle'></i></button>
            <button onclick="formatDoc('justifyRight')"><i class='bx bx-align-right'></i></button>
            <button onclick="formatDoc('justifyFull')"><i class='bx bx-align-justify'></i></button>
            <button onclick="formatDoc('insertOrderedList')"><i class='bx bx-list-ol'></i></button>
            <button onclick="formatDoc('insertUnorderedList')"><i class='bx bx-list-ul'></i></button>
            <button onclick="addLink()"><i class='bx bx-link'></i></button>
            <button onclick="formatDoc('unlink')"><i class='bx bx-unlink'></i></button>
            <button id="show-code" data-active="false">&lt;/&gt;</button>
          </div>
        </div>
        <div id="content" contenteditable="true" spellcheck="false">
          Chào mừng bạn đến với khóa học HTML cơ bản! Khám phá thế giới của lập trình web và thiết kế trang web bằng
          cách học HTML, ngôn ngữ đánh dấu mạnh mẽ và quan trọng nhất. Trong khóa học này, bạn sẽ học cách tạo ra trang
          web từ đầu bằng cách sử dụng các thẻ, thuộc tính và cú pháp HTML.\n\nTừ việc tạo cấu trúc cơ bản của trang web
          đến việc nhúng hình ảnh, video và liên kết, bạn sẽ có cơ hội thực hành và áp dụng kiến thức ngay tại chỗ. Đồng
          thời, chúng tôi sẽ chia sẻ những chiến lược tốt nhất để tối ưu hóa trang web của bạn cho trải nghiệm người
          dùng tốt nhất.\n\nKhông cần kinh nghiệm trước đây, khóa học này dành cho tất cả mọi người muốn bắt đầu hành
          trình của mình trong lập trình web. Hãy sẵn sàng tham gia vào hành trình sáng tạo và khám phá tiềm năng không
          giới hạn của bạn trong thế giới web phát triển với khóa học HTML này!
        </div>
      </div>





      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <input type="submit" value="update course" name="submit" class="btn">
    </form>

  </section>







  <section class="form-container">
    <form action="" method="post" enctype="multipart/form-data" id="updateVideoForm">
      <section class="playlist-videos">
        <h1 class="heading">Update playlist videos</h1>
        <div id="error-message"></div>
        <!-- <form id="video-upload-form" enctype="multipart/form-data">
          <input type="file" accept="video/*" id="video-input" name="video" required class="box">
          <button type="button" onclick="uploadVideo()" class="inline-btn">Upload</button>
        </form> -->
        <p>add Video</p>
        <input type="file" accept="video/*" id="video-input" name="video" required class="box">
        <p>add thumbnail</p>
        <input type="file" accept="image/*" id="thumbnail-video-input" required name="thumbnail" class="box">
        <p>video title</p>
        <input type="text" name="title" maxlength="50" class="box" required id="title-video-input">
        <button type="submit" class="inline-btn">Upload</button>
        <div class="box-container" id="container-playlist-video">

          <!-- <div class="card">
            <div class="card-image skeleton">
              <img src="https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTB8fGlsbHVzdHJhdGlvbnxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60" alt="">
            </div>
            <a href="#" class="card-title skeleton">Card title here</a>
          </div> -->


        </div>
      </section>

    </form>
  </section>


















  <!-- custom js file link  -->
  <script src="js/script.js"></script>


  <script>
    const accessToken = localStorage.getItem('accessToken');
    const refreshToken = localStorage.getItem('refreshToken');
    const userData = localStorage.getItem('userLoginData')
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("id");
    const form = document.getElementById('updateCoursesForm');
    const descriptionContent = document.getElementById('content');
    const videoPlaylistContainer = document.getElementById('container-playlist-video');
    const errorMessageContainer = document.getElementById('error-message');



    
    // Function to delete a video item
    async function deleteItem(videoId) {
      const apiUrl = `https://uit-edu.onrender.com/api/videos/${videoId}`;

      try {
        const response = await fetch(apiUrl, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'Access-Token': accessToken,
            'Refresh-Token': refreshToken,
          },
        });

        const data = await response.json();

        if (data.success) {
          console.log(`Video with ID ${videoId} deleted successfully`);
          // Reload the page or update the UI as needed
          window.location.reload();
        } else {
          console.error('Failed to delete video:', data.message);
        }
      } catch (error) {
        console.error('Error during API call:', error.message);
      }
    }










    function createVideoPlaylistSkeleton() {
      const cardElement = document.createElement('div');
      cardElement.className = 'card';

      const actionContainer = document.createElement('div');
      actionContainer.className = 'action-container skeleton';
      actionContainer.innerHTML = `
<i class="fa-solid fa-pen-to-square"></i>
<i class="fa-solid fa-trash"></i>
`;
      cardElement.appendChild(actionContainer);

      const cardImage = document.createElement('div');
      cardImage.className = 'card-image skeleton';
      cardImage.innerHTML = `
<img src="https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTB8fGlsbHVzdHJhdGlvbnxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60" alt="">
`;
      cardElement.appendChild(cardImage);

      const cardTitle = document.createElement('a');
      cardTitle.href = '#';
      cardTitle.className = 'card-title skeleton';
      cardTitle.textContent = 'Card title here';
      cardElement.appendChild(cardTitle);
      return cardElement;
    }





    document.addEventListener('DOMContentLoaded', async function () {
      // Create skeleton loading
      for (let i = 0; i <= 5; i++) {
        const cardElement = createVideoPlaylistSkeleton();
        videoPlaylistContainer.appendChild(cardElement);
      }


      const welcomeMessages = document.getElementsByClassName('user-name');
      const userRoleDisplay = document.getElementsByClassName('role');
      const titleCourses = document.getElementById('')
      if (userData) {
        const decodedData = JSON.parse(decodeURIComponent(userData));
        console.log(decodedData);
        for (const welcomeMessage of welcomeMessages) {
          welcomeMessage.textContent = `${decodedData.name}`;
        }
        for (const role of userRoleDisplay) {
          role.textContent = `${decodedData.role}`
        }

        // Hide links for non-admin users
        if (decodedData.role === 'student') {
          document.getElementById('aboutLink').style.display = 'flex';
          document.getElementById('coursesLink').style.display = 'flex';
        } else {
          document.getElementById('editPostLink').style.display = 'flex';
          document.getElementById('aboutLink').style.display = 'flex';
          document.getElementById('coursesLink').style.display = 'flex';
          document.getElementById('adminLink').style.display = 'flex';
        }
      }

      //=================== update elements when screen init
      const apiUrl = `https://uit-edu.onrender.com/api/courses/${courseId}`;
      try {
        const response = await fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Access-Token': accessToken,
            'Refresh-Token': refreshToken,
          },
        });

        const dataRes = await response.json();
        console.log(dataRes);
        if (dataRes.success === true) {
          form.querySelector('[name="title"]').value = dataRes.message.title;
          descriptionContent.innerText = dataRes.message.description;

          replaceSkeletonWithActualContent(dataRes.message.video);

        }
      } catch (e) {
        console.log('Error in fetch with _id', e.message);
      }







      //Handle submit data courses (title and description)
      form.addEventListener('submit', async function (event) {
        event.preventDefault()
        // Retrieve data from the form
        const title = form.querySelector('[name="title"]').value;
        const description = document.getElementById('content').innerText;



        // Prepare the request body
        const requestBody = {
          title: title,
          description: description,
          // Add any other data you need to send to the API
        };

        // Make the API call
        try {
          const response = await fetch(apiUrl, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Access-Token': accessToken,
              'Refresh-Token': refreshToken,
            },
            body: JSON.stringify(requestBody),
          });

          const data = await response.json();

          // Handle the API response as needed
          if (data.success) {
            console.log('Course updated successfully');
            window.location.reload();
          } else {
            // Handle errors or display error messages
            console.error('Failed to update course:', data.message);
          }
        } catch (error) {
          console.error('Error during API call:', error.message);
        }
      });

    });





    // Function to create a card with actual content
    function createCardWithData(video) {
      const cardElement = document.createElement('div');
      cardElement.className = 'card';

      // Populate card with actual data from the API
      // Update properties like course.instructor, course.thumbnail, etc.
      cardElement.innerHTML = `
      <div class="action-container" data-card-id="${video._id}">

         <i class="fa-solid fa-trash"></i>
      </div>
      <div class="card-image">
         <img src="${video.thumbnail}" alt="">
      </div>
      <a href="playlist.html?id=${video._id}" class="card-title">${video.title}</a>`;

      return cardElement;
    }





    // Function to remove skeletons and append actual content
    function replaceSkeletonWithActualContent(dataVideos) {
      const videoPlaylistContainer = document.getElementById('container-playlist-video');

      // Remove existing skeletons
      const skeletons = videoPlaylistContainer.querySelectorAll('.skeleton');
      skeletons.forEach(skeleton => {
        skeleton.remove();
      });


      // Remove existing cards
      const existingCards = videoPlaylistContainer.querySelectorAll('.card');
      existingCards.forEach(card => {
        card.remove();
      });

      dataVideos.forEach(course => {
        const cardElement = createCardWithData(course);
        videoPlaylistContainer.appendChild(cardElement);
      });


    }







    // Handle skeleton UX
    const allSkeleton = document.querySelectorAll('.skeleton');

    // Thực hiện sau khi trang đã được load
    window.addEventListener('load', function () {
      // Delay 2 giây
      setTimeout(function () {
        allSkeleton.forEach(item => {
          item.classList.remove('skeleton');
        });
      }, 900); // 2000 milliseconds = 2 seconds
    });
  </script>

</body>

</html>